<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Candy Shrink - Free HTML5 Game</title>
<meta name="description" content="Play Candy Shrink - Tap to freeze shrinking candy shapes and match them to outlines before they disappear.">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#1a0a2e">
<meta property="og:type" content="website">
<meta property="og:title" content="Candy Shrink - Free HTML5 Game">
<meta property="og:description" content="Tap to freeze shrinking candy shapes and match them to outlines before they disappear. How high can you score?">
<meta property="og:url" content="https://balinti.github.io/candy-shrink/">
<meta property="og:image" content="https://balinti.github.io/candy-shrink/og-image.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Candy Shrink - Free HTML5 Game">
<meta name="twitter:description" content="Tap to freeze shrinking candy shapes and match them to outlines before they disappear.">
<meta name="twitter:image" content="https://balinti.github.io/candy-shrink/og-image.png">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4099346100621490" crossorigin="anonymous"></script>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#0d0520;font-family:'Segoe UI',system-ui,-apple-system,sans-serif;color:#fff;touch-action:manipulation;-webkit-tap-highlight-color:transparent;user-select:none;-webkit-user-select:none}
body{display:flex;flex-direction:column;align-items:center;min-height:100vh;min-height:100dvh}
header{width:100%;max-width:420px;flex-shrink:0;padding:8px 16px;display:flex;justify-content:space-between;align-items:center;z-index:10;min-height:44px}
.hud-item{font-size:13px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;opacity:.85}
.hud-val{font-size:20px;font-weight:900;display:block;line-height:1.1}
.hud-mult{color:#ffdf00;text-shadow:0 0 12px rgba(255,223,0,.6)}
main{flex:1;display:flex;align-items:center;justify-content:center;width:100%;max-width:420px;position:relative;overflow:hidden}
canvas{display:block;width:100%;height:100%;border-radius:12px}
footer{width:100%;max-width:420px;min-height:60px;flex-shrink:0}
.overlay{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:20;pointer-events:auto;background:rgba(10,3,25,.82);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);border-radius:12px;padding:24px;text-align:center;opacity:0;transition:opacity .3s}
.overlay.visible{opacity:1}
.overlay h1{font-size:36px;font-weight:900;background:linear-gradient(135deg,#ff6fd8,#ffbe76,#ff6fd8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:8px;text-shadow:none}
.overlay .sub{font-size:15px;opacity:.7;margin-bottom:24px;max-width:280px}
.overlay .challenge-msg{font-size:14px;color:#ffbe76;margin-bottom:12px;font-weight:600}
.overlay .score-display{font-size:56px;font-weight:900;color:#ffdf00;text-shadow:0 0 20px rgba(255,223,0,.5);line-height:1}
.overlay .best-display{font-size:16px;opacity:.6;margin-top:4px;margin-bottom:20px}
.overlay .combo-display{font-size:14px;color:#ff6fd8;margin-bottom:16px}
.overlay .tap-msg{font-size:18px;font-weight:700;animation:pulse 1.5s ease-in-out infinite;margin-top:12px}
.share-btn{background:linear-gradient(135deg,#ff6fd8,#d63384);border:none;color:#fff;font-size:14px;font-weight:700;padding:10px 24px;border-radius:30px;cursor:pointer;margin-top:12px;transition:transform .15s}
.share-btn:active{transform:scale(.95)}
@keyframes pulse{0%,100%{opacity:.5;transform:scale(1)}50%{opacity:1;transform:scale(1.05)}}
.seo-content{max-width:420px;width:100%;padding:20px 16px;color:rgba(255,255,255,.55);font-size:12px;line-height:1.6}
.seo-content h2{font-size:15px;color:rgba(255,255,255,.7);margin:12px 0 4px}
.seo-content p,.seo-content details{margin-bottom:8px}
.seo-content summary{cursor:pointer;font-weight:600;color:rgba(255,255,255,.65)}
</style>
</head>
<body>
<header>
<div class="hud-item">SCORE<span class="hud-val" id="hud-score">0</span></div>
<div class="hud-item hud-mult">x<span class="hud-val" id="hud-mult">1</span></div>
<div class="hud-item">BEST<span class="hud-val" id="hud-best">0</span></div>
</header>
<main id="game-container">
<canvas id="gc"></canvas>
<div class="overlay visible" id="overlay-start">
<h1>Candy Shrink</h1>
<div class="challenge-msg" id="challenge-msg" style="display:none"></div>
<div class="sub">Tap when shrinking candies match the ring. Chain combos for massive points!</div>
<div class="tap-msg">Tap to Start</div>
</div>
<div class="overlay" id="overlay-gameover">
<div style="font-size:14px;opacity:.5;margin-bottom:4px">GAME OVER</div>
<div class="score-display" id="go-score">0</div>
<div class="best-display" id="go-best">Best: 0</div>
<div class="combo-display" id="go-combo">Best combo: 0x</div>
<button class="share-btn" id="share-btn">Challenge a Friend</button>
<div class="tap-msg">Tap to Retry</div>
</div>
</main>
<footer></footer>
<section class="seo-content" aria-label="Game information">
<h2>How to Play Candy Shrink</h2>
<p>Candies spawn from the edges and drift toward the center while shrinking. A target ring slides left and right. Tap or press Space to send a shockwave from the ring. Pop candies whose size matches the ring for points. Get a Perfect match for big bonuses and multiplier increases. Chain multiple pops in one shockwave for combo bonuses. Don't let candies shrink too small or you lose!</p>
<details><summary>FAQ</summary>
<p><strong>What is a Perfect pop?</strong> When a candy's radius is very close to the ring's radius, you score a Perfect and your multiplier goes up.</p>
<p><strong>How do combos work?</strong> One shockwave can hit multiple candies. Each extra candy in a single tap gives a combo bonus.</p>
<p><strong>What are tough candies?</strong> After 30 seconds, some candies require 2 taps to pop. They have a thicker border.</p>
<p><strong>Does difficulty increase?</strong> Yes! Candies spawn faster, the ring moves quicker, and tolerances tighten over time.</p>
</details>
</section>
<script>
'use strict';
(()=>{
const canvas=document.getElementById('gc');
const ctx=canvas.getContext('2d');
const container=document.getElementById('game-container');
const overlayStart=document.getElementById('overlay-start');
const overlayGameover=document.getElementById('overlay-gameover');
const hudScore=document.getElementById('hud-score');
const hudMult=document.getElementById('hud-mult');
const hudBest=document.getElementById('hud-best');
const goScore=document.getElementById('go-score');
const goBest=document.getElementById('go-best');
const goCombo=document.getElementById('go-combo');
const shareBtn=document.getElementById('share-btn');
const challengeMsg=document.getElementById('challenge-msg');

const DPR=Math.min(window.devicePixelRatio||1,3);
let W,H,cw,ch;

function resize(){
  const r=container.getBoundingClientRect();
  W=r.width;H=r.height;
  canvas.width=W*DPR;canvas.height=H*DPR;
  canvas.style.width=W+'px';canvas.style.height=H+'px';
  cw=W;ch=H;
}
resize();
window.addEventListener('resize',resize);

// deep-link
const urlP=new URLSearchParams(window.location.search);
const friendScore=urlP.get('score');
const friendCombo=urlP.get('combo');
if(friendScore){
  challengeMsg.textContent=`Your friend scored ${friendScore}${friendCombo?' with a '+friendCombo+'x combo':''}. Beat it!`;
  challengeMsg.style.display='block';
}

// state
const ST={START:0,PLAY:1,OVER:2};
let state=ST.START;
let score=0;
let best=parseInt(localStorage.getItem('cs_best'))||0;
let multiplier=1;
let bestCombo=0;
let runTime=0;
let shakeTimer=0;
let shakeIntensity=0;

hudBest.textContent=best;

// ring
const ring={x:0,y:0,r:36,dir:1,speed:40,hue:300};

// arrays
let candies=[];
let particles=[];
let textPops=[];
let shockwaves=[];

const MAX_PARTICLES=200;
const MAX_TEXTPOPS=20;

// candy
function spawnCandy(){
  const angle=Math.random()*Math.PI*2;
  const dist=Math.max(cw,ch)*0.6+Math.random()*40;
  const cx=cw/2+Math.cos(angle)*dist;
  const cy=ch/2+Math.sin(angle)*dist;
  const hue=Math.random()*360;
  const startR=50+Math.random()*20;
  const tough=runTime>30&&Math.random()<0.2;
  candies.push({
    x:cx,y:cy,r:startR,hue,
    vx:(cw/2-cx)*0.3/dist*60,
    vy:(ch/2-cy)*0.3/dist*60,
    shrinkRate:8+runTime*0.08,
    hp:tough?2:1,
    tough,
    alpha:1,
    dead:false,
    popped:false
  });
}

// particles
function emitParticles(x,y,hue,count,speed){
  for(let i=0;i<count&&particles.length<MAX_PARTICLES;i++){
    const a=Math.random()*Math.PI*2;
    const s=Math.random()*speed+speed*0.3;
    particles.push({
      x,y,
      vx:Math.cos(a)*s,vy:Math.sin(a)*s,
      r:2+Math.random()*3,
      hue:hue+Math.random()*40-20,
      life:1,
      decay:1.5+Math.random()*1.5,
      type:Math.random()<0.3?'sparkle':'circle'
    });
  }
}

function emitSyrup(x,y,hue){
  for(let i=0;i<5&&particles.length<MAX_PARTICLES;i++){
    particles.push({
      x:x+Math.random()*20-10,y:y+Math.random()*20-10,
      vx:Math.random()*20-10,vy:30+Math.random()*40,
      r:3+Math.random()*4,
      hue,life:1,decay:0.8+Math.random()*0.5,
      type:'drip'
    });
  }
}

function addTextPop(x,y,text,color,size){
  if(textPops.length>=MAX_TEXTPOPS)textPops.shift();
  textPops.push({x,y,text,color,size:size||18,life:1,vy:-60});
}

// shockwave
function fireShockwave(){
  shockwaves.push({
    x:ring.x,y:ring.y,r:0,maxR:Math.max(cw,ch)*0.6,
    speed:500,alpha:1,hue:ring.hue
  });

  let combo=0;
  let comboScore=0;

  candies.forEach(c=>{
    if(c.dead||c.popped)return;
    const dx=c.x-ring.x;
    const dy=c.y-ring.y;
    const dist=Math.sqrt(dx*dx+dy*dy);
    // difficulty tightens tolerances
    const tighten=Math.max(0,1-runTime*0.005);
    const perfectBand=6+tighten*4;
    const okBand=14+tighten*6;
    const looseBand=22+tighten*8;

    const sizeDiff=Math.abs(c.r-ring.r);
    // must be reachable by shockwave and reasonably close to ring area
    if(dist<ring.r+c.r+looseBand+40){
      if(sizeDiff<=looseBand){
        c.hp--;
        if(c.hp<=0){
          c.popped=true;c.dead=true;
          combo++;
          let pts=0;
          let label='';
          let col='#fff';
          if(sizeDiff<=perfectBand){
            pts=100*multiplier;
            multiplier=Math.min(multiplier+1,20);
            label='PERFECT!';col='#ffdf00';
            emitParticles(c.x,c.y,c.hue,25,180);
            emitSyrup(c.x,c.y,c.hue);
            shakeIntensity=Math.max(shakeIntensity,3);shakeTimer=0.15;
          }else if(sizeDiff<=okBand){
            pts=40*multiplier;
            label='OK!';col='#88ff88';
            emitParticles(c.x,c.y,c.hue,15,120);
          }else{
            pts=10;
            label='meh';col='rgba(255,255,255,.5)';
            emitParticles(c.x,c.y,c.hue,8,80);
          }
          comboScore+=pts;
          addTextPop(c.x,c.y-c.r-10,label,col,sizeDiff<=perfectBand?24:16);
        }else{
          // tough candy hit once
          emitParticles(c.x,c.y,c.hue,8,60);
          addTextPop(c.x,c.y-c.r-10,'CRACK!','#ffaa44',14);
        }
      }
    }
  });

  if(combo>1){
    comboScore+=combo*25*multiplier;
    addTextPop(ring.x,ring.y-ring.r-30,combo+'x COMBO!','#ff6fd8',28);
    if(combo>=4){
      shakeIntensity=Math.max(shakeIntensity,5);shakeTimer=0.2;
    }
  }
  if(combo>bestCombo)bestCombo=combo;
  score+=comboScore;
}

// difficulty
let spawnTimer=0;
function getSpawnInterval(){return Math.max(0.35,1.2-runTime*0.012);}

// update
function update(dt){
  if(state!==ST.PLAY)return;
  runTime+=dt;

  // ring motion
  const ringSpeed=ring.speed+runTime*0.5;
  ring.x+=ring.dir*ringSpeed*dt;
  if(ring.x>cw-60){ring.dir=-1;ring.x=cw-60;}
  if(ring.x<60){ring.dir=1;ring.x=60;}
  ring.y=ch*0.45+Math.sin(runTime*0.7)*20;
  ring.hue=(ring.hue+60*dt)%360;

  // spawn
  spawnTimer-=dt;
  if(spawnTimer<=0){
    spawnCandy();
    spawnTimer=getSpawnInterval();
  }

  // candies
  for(let i=candies.length-1;i>=0;i--){
    const c=candies[i];
    if(c.dead){
      c.alpha-=dt*4;
      if(c.alpha<=0)candies.splice(i,1);
      continue;
    }
    c.x+=c.vx*dt;
    c.y+=c.vy*dt;
    c.r-=c.shrinkRate*dt;
    if(c.r<4){
      // stale - game over
      c.dead=true;
      emitParticles(c.x,c.y,0,20,100);
      triggerGameOver();
      return;
    }
  }

  // shockwaves
  for(let i=shockwaves.length-1;i>=0;i--){
    const s=shockwaves[i];
    s.r+=s.speed*dt;
    s.alpha=1-s.r/s.maxR;
    if(s.alpha<=0)shockwaves.splice(i,1);
  }

  // particles
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.x+=p.vx*dt;p.y+=p.vy*dt;
    p.vy+=200*dt; // gravity
    p.life-=p.decay*dt;
    if(p.life<=0)particles.splice(i,1);
  }

  // text pops
  for(let i=textPops.length-1;i>=0;i--){
    const t=textPops[i];
    t.y+=t.vy*dt;
    t.vy*=0.95;
    t.life-=dt*1.2;
    if(t.life<=0)textPops.splice(i,1);
  }

  // shake
  if(shakeTimer>0)shakeTimer-=dt;

  // hud
  hudScore.textContent=score;
  hudMult.textContent=multiplier;
}

// draw
function draw(){
  ctx.setTransform(DPR,0,0,DPR,0,0);

  // shake offset
  let sx=0,sy=0;
  if(shakeTimer>0){
    sx=(Math.random()-0.5)*shakeIntensity*2;
    sy=(Math.random()-0.5)*shakeIntensity*2;
    ctx.translate(sx,sy);
  }

  // bg gradient
  const grad=ctx.createLinearGradient(0,0,0,ch);
  grad.addColorStop(0,'#1a0a2e');
  grad.addColorStop(1,'#0d0520');
  ctx.fillStyle=grad;
  ctx.fillRect(-10,-10,cw+20,ch+20);

  // subtle bg dots
  ctx.globalAlpha=0.06;
  for(let i=0;i<40;i++){
    const bx=(i*97+runTime*5)%cw;
    const by=(i*71+runTime*3)%ch;
    ctx.beginPath();ctx.arc(bx,by,1.5,0,Math.PI*2);ctx.fillStyle='#fff';ctx.fill();
  }
  ctx.globalAlpha=1;

  if(state===ST.PLAY||state===ST.OVER){
    // draw ring target
    ctx.beginPath();
    ctx.arc(ring.x,ring.y,ring.r,0,Math.PI*2);
    ctx.strokeStyle=`hsla(${ring.hue},80%,65%,0.6)`;
    ctx.lineWidth=3;
    ctx.setLineDash([6,4]);
    ctx.stroke();
    ctx.setLineDash([]);
    // ring glow
    ctx.beginPath();
    ctx.arc(ring.x,ring.y,ring.r,0,Math.PI*2);
    ctx.strokeStyle=`hsla(${ring.hue},90%,70%,0.15)`;
    ctx.lineWidth=12;
    ctx.stroke();

    // shockwaves
    shockwaves.forEach(s=>{
      ctx.beginPath();
      ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
      ctx.strokeStyle=`hsla(${s.hue},80%,75%,${s.alpha*0.5})`;
      ctx.lineWidth=4;
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
      ctx.strokeStyle=`hsla(${s.hue},90%,85%,${s.alpha*0.25})`;
      ctx.lineWidth=12;
      ctx.stroke();
    });

    // candies
    candies.forEach(c=>{
      if(c.r<=0)return;
      ctx.globalAlpha=Math.max(0,c.alpha);
      // body
      const cg=ctx.createRadialGradient(c.x-c.r*0.3,c.y-c.r*0.3,c.r*0.1,c.x,c.y,c.r);
      cg.addColorStop(0,`hsla(${c.hue},85%,75%,0.95)`);
      cg.addColorStop(1,`hsla(${c.hue},70%,45%,0.9)`);
      ctx.beginPath();ctx.arc(c.x,c.y,c.r,0,Math.PI*2);
      ctx.fillStyle=cg;ctx.fill();
      // glossy highlight
      ctx.beginPath();
      ctx.ellipse(c.x-c.r*0.2,c.y-c.r*0.25,c.r*0.45,c.r*0.3,-.4,0,Math.PI*2);
      ctx.fillStyle='rgba(255,255,255,0.3)';
      ctx.fill();
      // tough candy extra ring
      if(c.tough&&c.hp>1){
        ctx.beginPath();ctx.arc(c.x,c.y,c.r+2,0,Math.PI*2);
        ctx.strokeStyle=`hsla(${c.hue},60%,90%,0.8)`;
        ctx.lineWidth=3;ctx.stroke();
        ctx.beginPath();ctx.arc(c.x,c.y,c.r-3,0,Math.PI*2);
        ctx.strokeStyle=`hsla(${c.hue},60%,90%,0.4)`;
        ctx.lineWidth=1;ctx.stroke();
      }
      ctx.globalAlpha=1;
    });

    // particles
    particles.forEach(p=>{
      ctx.globalAlpha=Math.max(0,p.life);
      if(p.type==='sparkle'){
        ctx.save();
        ctx.translate(p.x,p.y);
        ctx.rotate(p.life*6);
        ctx.fillStyle=`hsla(${p.hue},90%,80%,1)`;
        const sr=p.r*p.life;
        ctx.fillRect(-sr/2,-sr*2,sr,sr*4);
        ctx.fillRect(-sr*2,-sr/2,sr*4,sr);
        ctx.restore();
      }else if(p.type==='drip'){
        ctx.beginPath();
        ctx.ellipse(p.x,p.y,p.r*0.6*p.life,p.r*p.life,0,0,Math.PI*2);
        ctx.fillStyle=`hsla(${p.hue},70%,55%,0.8)`;
        ctx.fill();
      }else{
        ctx.beginPath();ctx.arc(p.x,p.y,p.r*p.life,0,Math.PI*2);
        ctx.fillStyle=`hsla(${p.hue},80%,70%,1)`;
        ctx.fill();
      }
      ctx.globalAlpha=1;
    });

    // text pops
    textPops.forEach(t=>{
      ctx.globalAlpha=Math.max(0,t.life);
      ctx.font=`${Math.round(t.size)}px 'Segoe UI',system-ui,sans-serif`;
      ctx.fontWeight='900';
      ctx.textAlign='center';
      ctx.fillStyle=t.color;
      ctx.shadowColor=t.color;
      ctx.shadowBlur=8;
      ctx.fillText(t.text,t.x,t.y);
      ctx.shadowBlur=0;
      ctx.globalAlpha=1;
    });
  }
}

// game over
function triggerGameOver(){
  state=ST.OVER;
  shakeIntensity=10;shakeTimer=0.4;
  if(score>best){
    best=score;
    localStorage.setItem('cs_best',best);
  }
  hudBest.textContent=best;
  goScore.textContent=score;
  goBest.textContent='Best: '+best;
  goCombo.textContent='Best combo: '+bestCombo+'x';
  setTimeout(()=>{overlayGameover.classList.add('visible');},600);
}

// start / restart
function startGame(){
  score=0;multiplier=1;bestCombo=0;runTime=0;
  spawnTimer=0.5;shakeTimer=0;shakeIntensity=0;
  candies=[];particles=[];textPops=[];shockwaves=[];
  ring.x=cw/2;ring.y=ch*0.45;ring.dir=1;ring.speed=40;
  hudScore.textContent='0';hudMult.textContent='1';
  state=ST.PLAY;
}

// input
function handleAction(){
  if(state===ST.START){
    overlayStart.classList.remove('visible');
    startGame();
  }else if(state===ST.PLAY){
    fireShockwave();
  }else if(state===ST.OVER){
    overlayGameover.classList.remove('visible');
    startGame();
  }
}

document.addEventListener('pointerdown',(e)=>{
  e.preventDefault();
  handleAction();
},{passive:false});

document.addEventListener('keydown',(e)=>{
  if(e.code==='Space'||e.code==='Enter'){
    e.preventDefault();
    handleAction();
  }
});

// share
shareBtn.addEventListener('pointerdown',(e)=>{
  e.stopPropagation();
},{passive:false});
shareBtn.addEventListener('click',(e)=>{
  e.stopPropagation();
  const url=`https://balinti.github.io/candy-shrink/?score=${score}&combo=${bestCombo}`;
  const text=`I scored ${score} in Candy Shrink with a ${bestCombo}x combo! Can you beat me?`;
  if(navigator.share){
    navigator.share({title:'Candy Shrink',text,url}).catch(()=>{});
  }else{
    navigator.clipboard.writeText(text+' '+url).then(()=>{
      shareBtn.textContent='Copied!';
      setTimeout(()=>{shareBtn.textContent='Challenge a Friend';},2000);
    }).catch(()=>{});
  }
});

// loop
let lastTime=0;
function loop(ts){
  const now=ts/1000;
  let dt=now-lastTime;
  lastTime=now;
  if(dt>0.1)dt=0.1; // clamp
  if(dt<=0)dt=1/60;

  update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame((ts)=>{
  lastTime=ts/1000;
  requestAnimationFrame(loop);
});

})();
</script>
</body>
</html>
