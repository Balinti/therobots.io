Build the game.

1) Create autonomous permissions file:
```bash
mkdir -p .claude
echo '{"permissions":{"allow":["bash(git *)","bash(gh *)","bash(cd *)","bash(mkdir *)","bash(cat *)","bash(echo *)","write(**)","read(**)","edit(**)"],"deny":["bash(rm -rf /)","bash(rm -rf ~)","bash(sudo *)","bash(chmod *)","bash(chown *)"]}}' > .claude/settings.json
```

2) Ensure project directory exists and move into it:
```bash
cd "C:/Users/Edoe/projects/games/nebula-swipe" || (mkdir "C:/Users/Edoe/projects/games/nebula-swipe" && cd "C:/Users/Edoe/projects/games/nebula-swipe")
```

3) Create a SINGLE self-contained `index.html` (inline CSS+JS only) implementing “Nebula Swipe: Prism Ring” exactly with:
- Canvas2D only, no libs, no WebGL
- rAF loop
- 3 states: start/playing/gameover
- pointerdown + Space/Enter input
- deterministic 120° clockwise rotation per tap
- comets spawn from edges toward center; color must match wedge hit; mismatch = instant death
- increasing difficulty via spawn interval + patterns (double/burst) + split comets (feint body color)
- particles on hits and death, HSL palette, subtle background parallax + fog, readable wedges with outlines
- screen shake on combo milestones and on death
- localStorage best score persistence
- centered container max 420x750, full viewport height on mobile, high-DPI scaling with devicePixelRatio (clamp to 2)
- minimal HUD for score/best/combo
- start screen “Tap to Start”, gameover “Tap to Retry” with score/best and share button (Web Share API + copy fallback)
- include a small accessible HTML text/FAQ block below canvas for SEO (can be visually subtle but readable/collapsible)

Write the file in one shot:
```bash
cat > index.html <<'HTML'
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Nebula Swipe - Free HTML5 Game</title>
  <meta name="description" content="Play Nebula Swipe - Swipe to match nebula colors while collecting random powerups that change gameplay speed.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#0b1020">

  <link rel="canonical" href="https://balinti.github.io/nebula-swipe/">

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Nebula Swipe - Prism Ring" />
  <meta property="og:description" content="One tap rotates the prism ring. Match incoming comet colors. Miss once and explode. Endless high-score challenge." />
  <meta property="og:url" content="https://balinti.github.io/nebula-swipe/" />
  <!-- No external assets allowed; omit og:image -->

  <!-- Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Nebula Swipe - Prism Ring" />
  <meta name="twitter:description" content="One-tap reflex color match. Beat my score." />

  <!-- AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4099346100621490" crossorigin="anonymous"></script>

  <style>
    :root{
      --bg0:#060814;
      --bg1:#0b1020;
      --ink:#eaf0ff;
      --muted:rgba(234,240,255,.72);
      --muted2:rgba(234,240,255,.55);
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.09);
      --stroke:rgba(255,255,255,.12);
    }
    html,body{height:100%; margin:0; background: radial-gradient(1200px 900px at 50% 20%, #101a3a 0%, var(--bg1) 45%, var(--bg0) 100%); color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji"; }
    body{display:flex; align-items:center; justify-content:center; padding: 12px; box-sizing:border-box;}
    #shell{
      width:min(420px, 100vw);
      height:min(750px, 100vh);
      max-width:420px;
      max-height:750px;
      position:relative;
      border-radius:18px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
    }
    canvas{
      width:100%;
      height:100%;
      display:block;
      touch-action: manipulation;
      user-select:none;
      -webkit-user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    #below{
      width:min(420px, 100vw);
      margin-top: 10px;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.35;
    }
    details{
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
      border-radius: 12px;
      padding: 10px 12px;
    }
    summary{cursor:pointer; color: var(--ink); font-weight: 650;}
    a{color:#b9d6ff}
    .sr{position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;}
  </style>
</head>
<body>
  <div>
    <div id="shell" aria-label="Nebula Swipe game container">
      <canvas id="c" aria-label="Nebula Swipe canvas game" role="img"></canvas>
      <div class="sr">
        Nebula Swipe: Prism Ring. Tap or press Space/Enter to rotate the ring. Match the incoming comet’s head color with the wedge it hits. Miss once and explode.
      </div>
    </div>

    <div id="below" aria-label="Game description and FAQ">
      <details>
        <summary>About Nebula Swipe (How to Play + FAQ)</summary>
        <p><strong>Nebula Swipe: Prism Ring</strong> is a free, one-tap HTML5 reflex game. Tap/click (or press Space/Enter) to rotate a 3-color ring. Incoming comets fly toward the center—match the comet’s <em>head color</em> to the wedge it hits. One mismatch ends the run.</p>
        <p><strong>Controls:</strong> Tap/click = rotate 120° clockwise. Space/Enter works too.</p>
        <p><strong>Tip:</strong> Rotation is instant—tap a beat earlier than you think.</p>
        <p><strong>Privacy:</strong> Best score is stored locally in your browser via <code>localStorage</code>.</p>
      </details>
    </div>
  </div>

  <script>
  (() => {
    'use strict';

    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d', { alpha: false });

    // --- Utilities ---
    const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
    const rand = (a, b) => a + Math.random() * (b - a);
    const randi = (a, b) => (a + Math.floor(Math.random() * (b - a + 1)));
    const wrapAngle = (a) => {
      const t = Math.PI * 2;
      a = a % t;
      return a < 0 ? a + t : a;
    };
    const lerpAngle = (a, b, t) => {
      const tau = Math.PI * 2;
      let d = (b - a) % tau;
      if (d > Math.PI) d -= tau;
      if (d < -Math.PI) d += tau;
      return a + d * t;
    };
    const hsl = (h, s=90, l=60, a=1) => `hsla(${h} ${s}% ${l}% / ${a})`;

    // --- Layout / DPI ---
    let cw = 0, ch = 0, dpr = 1;
    let CX = 0, CY = 0;

    function resize() {
      const shell = document.getElementById('shell');
      const rect = shell.getBoundingClientRect();
      cw = Math.floor(rect.width);
      ch = Math.floor(rect.height);

      dpr = Math.min(window.devicePixelRatio || 1, 2);
      canvas.style.width = cw + 'px';
      canvas.style.height = ch + 'px';
      canvas.width = Math.floor(cw * dpr);
      canvas.height = Math.floor(ch * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

      CX = cw * 0.5;
      CY = ch * 0.5;

      // Re-derive sizes
      const minDim = Math.min(cw, ch);
      ring.radius = minDim * 0.16;
      ring.baseThickness = Math.max(14, ring.radius * 0.28);
      ring.thickness = ring.baseThickness;
      cometBaseR = Math.max(10, ring.radius * 0.18);
      ring.x = CX; ring.y = CY;

      // Rebuild background stars
      buildStars();
      buildFog();
    }

    // --- Game constants / palette ---
    const baseHues = [190, 315, 55]; // cyan, magenta, yellow
    const bgBaseHue = 230;

    const HS_KEY = 'prismRingHighScore';
    let best = Number(localStorage.getItem(HS_KEY) || 0);

    // --- Game state ---
    const game = {
      state: 'start', // 'start' | 'playing' | 'gameover'
      t: 0,
      score: 0,
      combo: 0,
      newBest: false,
      deathAt: 0,
      deathFreeze: 0.25,
      overlayHint: '',
      challengeTarget: null, // from URL
      showShareRowAt: 0,
    };

    // --- Ring ---
    const ring = {
      x: 0, y: 0,
      radius: 60,
      baseThickness: 18,
      thickness: 18,
      slices: 3,
      step: (Math.PI * 2) / 3,
      rot: -Math.PI / 2,
      targetRot: -Math.PI / 2,
      rotSpeed: 18.0,
      pulse: 0,
      aura: 0, // 0..1
    };

    // --- Comets / Particles ---
    let comets = [];
    let particles = [];
    let cometBaseR = 12;

    // spawn scheduling
    let spawnTimer = 0;
    let queuedSpawns = []; // times (relative) to spawn additional comets in patterns

    // screen shake
    const shake = { t: 0, dur: 0, amp: 0 };

    // background layers
    let stars = [];
    let fog = [];

    function buildStars() {
      stars = [];
      const count = Math.floor((cw * ch) / 5200);
      for (let i = 0; i < count; i++) {
        stars.push({
          x: Math.random() * cw,
          y: Math.random() * ch,
          z: rand(0.4, 1.0),
          r: rand(0.6, 1.6),
          tw: rand(0, Math.PI * 2),
        });
      }
    }

    function buildFog() {
      fog = [];
      const n = 6;
      for (let i = 0; i < n; i++) {
        fog.push({
          x: rand(-cw*0.2, cw*1.2),
          y: rand(-ch*0.2, ch*1.2),
          r: rand(Math.min(cw,ch)*0.18, Math.min(cw,ch)*0.42),
          a: rand(0.03, 0.07),
          h: bgBaseHue + rand(-18, 18),
          vx: rand(-6, 6),
          vy: rand(-4, 4),
        });
      }
    }

    function resetRun() {
      game.state = 'playing';
      game.t = 0;
      game.score = 0;
      game.combo = 0;
      game.newBest = false;
      game.deathAt = -999;
      game.overlayHint = '';
      game.showShareRowAt = 0;

      comets = [];
      particles = [];
      spawnTimer = 0.35;
      queuedSpawns = [];

      ring.rot = -Math.PI / 2;
      ring.targetRot = ring.rot;
      ring.pulse = 0;
      ring.aura = 0;
      shake.t = 0; shake.dur = 0; shake.amp = 0;
    }

    function setGameOver(reason='') {
      game.state = 'gameover';
      game.deathAt = game.t;
      game.showShareRowAt = game.t + 1.2;
      game.overlayHint = reason;

      // big shake + flash particles
      triggerShake(14, 0.35);
      emitExplosion(CX, CY, 90, 0.95);

      if (game.score > best) {
        best = game.score;
        localStorage.setItem(HS_KEY, String(best));
        game.newBest = true;
      }
    }

    function triggerShake(amp, dur) {
      shake.t = 0;
      shake.amp = amp;
      shake.dur = dur;
    }

    function spawnComet(opts={}) {
      const s = game.score;

      // edge spawn
      const m = 30;
      const edge = randi(0, 3);
      let x, y;
      if (edge === 0) { x = rand(0, cw); y = -m; }
      else if (edge === 1) { x = rand(0, cw); y = ch + m; }
      else if (edge === 2) { x = -m; y = rand(0, ch); }
      else { x = cw + m; y = rand(0, ch); }

      const dx = CX - x, dy = CY - y;
      const len = Math.hypot(dx, dy) || 1;
      const ux = dx / len, uy = dy / len;

      const v0 = 220;
      let v = v0 + 6.0 * s + 18.0 * Math.log2(1 + s);
      v = Math.min(v, 520);

      const colorIndex = (opts.colorIndex ?? randi(0, 2));
      const splitEnabled = (s >= 25);
      const splitRate = (s < 50 ? 0.25 : 0.30);
      const isSplit = !!opts.isSplit || (splitEnabled && Math.random() < splitRate);

      let feintIndex = null;
      if (isSplit) {
        feintIndex = randi(0, 2);
        if (feintIndex === colorIndex) feintIndex = (feintIndex + 1) % 3;
      }

      const r = cometBaseR;

      comets.push({
        x, y,
        vx: ux * v,
        vy: uy * v,
        r,
        colorIndex,
        feintIndex,
        isSplit,
        trail: [],
        alive: true,
        hit: false,
      });
    }

    function emitHit(x, y, hue, combo) {
      const extra = (combo >= 10 ? 10 : 0);
      const N = 26 + extra;
      for (let i = 0; i < N; i++) {
        const a = rand(0, Math.PI * 2);
        const spd = rand(80, 260);
        particles.push({
          x, y,
          vx: Math.cos(a) * spd,
          vy: Math.sin(a) * spd,
          life: 0,
          ttl: 0.45,
          size: rand(1.4, 2.6),
          hue,
          alpha: 1,
          add: true,
        });
      }
    }

    function emitExplosion(x, y, N, ttl=0.9) {
      for (let i = 0; i < N; i++) {
        const a = rand(0, Math.PI * 2);
        const spd = rand(120, 520);
        particles.push({
          x, y,
          vx: Math.cos(a) * spd,
          vy: Math.sin(a) * spd,
          life: 0,
          ttl,
          size: rand(1.6, 3.6),
          hue: rand(0, 360),
          alpha: 1,
          add: false,
        });
      }
      // white flash particles
      for (let i = 0; i < 24; i++) {
        const a = rand(0, Math.PI * 2);
        const spd = rand(80, 420);
        particles.push({
          x, y,
          vx: Math.cos(a) * spd,
          vy: Math.sin(a) * spd,
          life: 0,
          ttl: 0.55,
          size: rand(2.0, 4.8),
          hue: 0,
          alpha: 1,
          add: false,
          white: true,
        });
      }
    }

    function spawnIntervalForScore(s) {
      return clamp(0.95 - 0.010 * s, 0.34, 0.95);
    }

    function schedulePatterns() {
      const s = game.score;

      // base: always spawn one now
      spawnComet();

      if (s < 10) return;

      // 10–25: occasional double
      if (s >= 10 && s < 25) {
        if (Math.random() < 0.20) queuedSpawns.push(0.18);
        return;
      }

      // 25–50: doubles + split comets already enabled in spawnComet
      if (s >= 25 && s < 50) {
        if (Math.random() < 0.22) queuedSpawns.push(0.18);
        return;
      }

      // 50+: bursts
      if (s >= 50) {
        if (Math.random() < 0.18) {
          const k = randi(3, 5);
          for (let i = 1; i < k; i++) queuedSpawns.push(i * 0.14);
        } else if (Math.random() < 0.22) {
          queuedSpawns.push(0.18);
        }
      }
    }

    function action() {
      if (game.state === 'start') {
        resetRun();
        return;
      }
      if (game.state === 'playing') {
        ring.targetRot += ring.step;
        return;
      }
      if (game.state === 'gameover') {
        if (game.t - game.deathAt < game.deathFreeze) return;
        resetRun();
      }
    }

    // Input
    canvas.addEventListener('pointerdown', () => action(), { passive: true });
    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space' || e.code === 'Enter') {
        e.preventDefault();
        action();
      }
    }, { passive: false });

    // Share
    async function shareScore() {
      const score = game.score;
      const url = new URL(location.href);
      url.searchParams.set('challenge', String(score));
      const text = `I scored ${score} in Nebula Swipe: Prism Ring. Can you beat me?`;
      const shareData = { title: 'Neb