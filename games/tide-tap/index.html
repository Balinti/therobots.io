<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tide Tap - Free HTML5 Game</title>
<meta name="description" content="Play Tide Tap - Tap to the ocean beat while dodging reversed controls to ride the waves.">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0a1628">
<link rel="canonical" href="https://balinti.github.io/tide-tap/">
<meta property="og:type" content="website">
<meta property="og:title" content="Tide Tap - Free HTML5 Game">
<meta property="og:description" content="Ride the crest, chain combos, dodge rocks. A hyper-casual HTML5 ocean game.">
<meta property="og:url" content="https://balinti.github.io/tide-tap/">
<meta property="og:image" content="https://balinti.github.io/tide-tap/og.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Tide Tap - Free HTML5 Game">
<meta name="twitter:description" content="Ride the crest, chain combos, dodge rocks. A hyper-casual HTML5 ocean game.">
<meta name="twitter:image" content="https://balinti.github.io/tide-tap/og.jpg">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"VideoGame","name":"Tide Tap: Crest Chain","url":"https://balinti.github.io/tide-tap/","image":"https://balinti.github.io/tide-tap/og.jpg","description":"Ride the crest, chain combos, dodge rocks. A hyper-casual HTML5 ocean game.","genre":"Casual","playMode":"SinglePlayer","applicationCategory":"Game","operatingSystem":"Web Browser"}
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4099346100621490" crossorigin="anonymous"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#0a1628;font-family:'Segoe UI',system-ui,sans-serif;touch-action:manipulation;-webkit-tap-highlight-color:transparent;user-select:none}
#app{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0a1628 0%,#0d1f3c 50%,#0a1628 100%)}
canvas{display:block;max-width:420px;max-height:750px;width:100%;height:100%;object-fit:contain}
#share-overlay{position:fixed;display:none;z-index:10;bottom:20%;left:50%;transform:translateX(-50%)}
#share-overlay button{padding:10px 24px;border:2px solid rgba(255,255,255,0.5);border-radius:24px;background:rgba(10,22,40,0.85);color:#fff;font-size:15px;font-family:inherit;cursor:pointer;backdrop-filter:blur(6px);transition:all .2s}
#share-overlay button:hover{background:rgba(30,60,100,0.9);border-color:#fff}
#copied-toast{position:fixed;bottom:12%;left:50%;transform:translateX(-50%);background:rgba(0,200,120,0.9);color:#fff;padding:8px 20px;border-radius:16px;font-size:14px;display:none;z-index:11;pointer-events:none}
</style>
</head>
<body>
<div id="app"><canvas id="gc"></canvas></div>
<div id="share-overlay"><button id="share-btn">Share Score</button></div>
<div id="copied-toast">Copied to clipboard!</div>
<script>
'use strict';
(function(){

const VW=420,VH=750;
const canvas=document.getElementById('gc');
const ctx=canvas.getContext('2d');
const shareOverlay=document.getElementById('share-overlay');
const shareBtn=document.getElementById('share-btn');
const copiedToast=document.getElementById('copied-toast');

// Hi-DPI
const DPR=Math.min(window.devicePixelRatio||1,2);
function resizeCanvas(){
  const app=document.getElementById('app');
  const aw=app.clientWidth,ah=app.clientHeight;
  const aspect=VW/VH;
  let w,h;
  if(aw/ah>aspect){h=ah;w=h*aspect}else{w=aw;h=w/aspect}
  w=Math.min(w,420);h=Math.min(h,750);
  canvas.style.width=w+'px';
  canvas.style.height=h+'px';
  canvas.width=Math.round(w*DPR);
  canvas.height=Math.round(h*DPR);
  ctx.setTransform(DPR*w/VW,0,0,DPR*h/VH,0,0);
}
resizeCanvas();
window.addEventListener('resize',resizeCanvas);

// --- RNG ---
function mulberry32(a){return function(){a|=0;a=a+0x6D2B79F5|0;let t=Math.imul(a^a>>>15,1|a);t=t+Math.imul(t^t>>>7,61|t)^t;return((t^t>>>14)>>>0)/4294967296}}
function dateToSeed(d){return(d.getFullYear()*10000+d.getMonth()*100+d.getDate())|0}
const urlP=new URLSearchParams(window.location.search);
const urlScore=parseInt(urlP.get('score'))||0;
const urlMult=parseInt(urlP.get('mult'))||0;
const urlSeed=urlP.get('seed')?parseInt(urlP.get('seed')):null;
const today=new Date();
const dailySeed=urlSeed!==null?urlSeed:dateToSeed(today);
let rng=mulberry32(dailySeed);

// --- State ---
let state='start';
let score=0,bestScore=0,combo=0,mult=1,missStreak=0;
let speed=1,baseSpeed=1.2,scroll=0;
let gameTime=0,lastTime=0,accumulator=0;
const STEP=1/120;
let shakeX=0,shakeY=0,shakeMag=0,shakeDecay=0.92;
let vignetteAlpha=0,desatFlash=0;
let hueShift=0;

// Surfer
const surferX=0.28*VW;
let surferY=VH*0.5,surferAngle=0;

// Rings
let rings=[];
let ringSpawnTimer=0;
let ringInterval=1.5;

// Rocks
let rocks=[];
let rockSpawnTimer=0;
let rockInterval=4;

// Particles
let particles=[];

// Foam particles (decorative)
let foamParticles=[];

// Load best
const LS_KEY='ttcc_highscore_v1';
try{bestScore=parseInt(localStorage.getItem(LS_KEY))||0}catch(e){}

// --- Wave ---
const waveBaseY=VH*0.52;
const waveAmp=45;
const waveK=0.018;
const waveAmp2=20;
const waveK2=0.025;
function waveY(x){
  return waveBaseY+waveAmp*Math.sin(waveK*(x+scroll))+waveAmp2*Math.sin(waveK2*(x+scroll)*1.7+1.3);
}
function waveDY(x){
  return waveAmp*waveK*Math.cos(waveK*(x+scroll))+waveAmp2*waveK2*1.7*Math.cos(waveK2*(x+scroll)*1.7+1.3);
}

// --- Spawn ---
function spawnRing(){
  const x=VW+60+rng()*80;
  rings.push({wx:x+scroll,radius:28+rng()*6,hitWindow:32+Math.max(0,18-gameTime*0.3),locked:false,missed:false,alpha:1,popScale:1,glow:0});
}
function spawnRock(){
  const x=VW+50+rng()*100;
  const baseW=waveY(x);
  const yOff=20+rng()*40;
  rocks.push({wx:x+scroll,y:baseW+yOff,r:12+rng()*10,hue:20+rng()*30});
}

// --- Particles ---
function emitParticles(x,y,count,hue,spread,life){
  for(let i=0;i<count;i++){
    const a=rng()*Math.PI*2;
    const sp=spread*(0.3+rng()*0.7);
    particles.push({x,y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp-1,life:life*(0.5+rng()*0.5),maxLife:life,hue:hue+rng()*30,size:2+rng()*3,alpha:1});
  }
}
function emitFoam(x,y,count){
  for(let i=0;i<count;i++){
    foamParticles.push({x:x+rng()*20-10,y:y+rng()*10,vx:-(0.3+rng()*0.5),vy:-rng()*0.5,life:0.8+rng()*0.8,maxLife:1.6,alpha:0.4+rng()*0.3,size:1.5+rng()*2.5});
  }
}

// --- Input ---
let tapQueued=false;
function onTap(){
  if(state==='start'){startGame();return}
  if(state==='gameover'){
    // Delay restart slightly to avoid accidental share-button taps
    startGame();return;
  }
  if(state==='playing')tapQueued=true;
}
canvas.addEventListener('pointerdown',e=>{e.preventDefault();onTap()});
document.addEventListener('keydown',e=>{
  if(e.code==='Space'||e.code==='Enter'){e.preventDefault();onTap()}
});

// Prevent space scroll
window.addEventListener('keydown',e=>{if(e.code==='Space')e.preventDefault()});

// --- Game lifecycle ---
function startGame(){
  state='playing';
  score=0;combo=0;mult=1;missStreak=0;
  speed=baseSpeed;scroll=0;gameTime=0;
  rings=[];rocks=[];particles=[];foamParticles=[];
  ringSpawnTimer=0;rockSpawnTimer=0;
  shakeMag=0;vignetteAlpha=0;desatFlash=0;
  rng=mulberry32(dailySeed);
  shareOverlay.style.display='none';
  spawnRing();
}

function gameOver(){
  state='gameover';
  shakeMag=12;
  vignetteAlpha=0.6;
  desatFlash=1;
  if(score>bestScore){
    bestScore=score;
    try{localStorage.setItem(LS_KEY,bestScore.toString())}catch(e){}
  }
  // Show share after short delay
  setTimeout(()=>{if(state==='gameover')shareOverlay.style.display='block'},600);
}

// --- Share ---
shareBtn.addEventListener('pointerdown',e=>{
  e.stopPropagation();
  const url=`https://balinti.github.io/tide-tap/?score=${score}&mult=${mult}&seed=${dailySeed}`;
  const text=`I scored ${score} (x${mult} combo) in Tide Tap: Crest Chain! Can you beat me?`;
  if(navigator.share){
    navigator.share({title:'Tide Tap: Crest Chain',text,url}).catch(()=>{});
  }else{
    navigator.clipboard.writeText(text+' '+url).then(()=>{
      copiedToast.style.display='block';
      setTimeout(()=>{copiedToast.style.display='none'},1800);
    }).catch(()=>{});
  }
});

// --- Fixed-step update ---
function update(){
  const dt=STEP;
  gameTime+=dt;
  hueShift+=dt*15;

  // Difficulty ramp
  const diffT=gameTime;
  const speedMult=1+diffT*0.012;
  const effectiveSpeed=speed*speedMult;
  scroll+=effectiveSpeed*60*dt;

  // Ring interval decreases
  ringInterval=Math.max(0.7,1.5-diffT*0.008);
  rockInterval=Math.max(1.8,4-diffT*0.015);

  // Surfer
  surferY=waveY(surferX);
  surferAngle=Math.atan2(waveDY(surferX),1)*0.6;

  // Spawn rings
  ringSpawnTimer+=dt;
  if(ringSpawnTimer>=ringInterval){ringSpawnTimer=0;spawnRing()}

  // Spawn rocks
  rockSpawnTimer+=dt;
  if(rockSpawnTimer>=rockInterval){rockSpawnTimer=0;spawnRock()}

  // Handle tap
  if(tapQueued){
    tapQueued=false;
    let hit=false;
    for(let i=0;i<rings.length;i++){
      const r=rings[i];
      if(r.locked||r.missed)continue;
      const sx=r.wx-scroll;
      const dist=Math.abs(sx-surferX);
      if(dist<r.hitWindow){
        r.locked=true;
        r.glow=1;
        combo++;
        mult=Math.min(1+Math.floor(combo/3),8);
        missStreak=0;
        speed=Math.min(speed+0.08,3.5);
        const ry=waveY(sx);
        emitParticles(sx,ry,12,180+hueShift%60,3,0.7);
        shakeMag=Math.max(shakeMag,2);
        hit=true;
        break;
      }
    }
    if(!hit){
      // Tap miss penalty (small)
      speed=Math.max(speed-0.05,baseSpeed*0.8);
    }
  }

  // Update rings
  for(let i=rings.length-1;i>=0;i--){
    const r=rings[i];
    const sx=r.wx-scroll;
    if(r.locked){
      r.popScale+=(1.4-r.popScale)*0.15;
      r.glow*=0.93;
      r.alpha-=dt*2;
      if(r.alpha<=0){rings.splice(i,1);continue}
    }else if(!r.missed&&sx<surferX-r.hitWindow){
      // Missed
      r.missed=true;
      missStreak++;
      combo=0;mult=1;
      speed=Math.max(speed-0.3,baseSpeed*0.7);
      vignetteAlpha=0.35;
      desatFlash=0.5;
      if(missStreak>=2){gameOver();return}
    }
    if(sx<-60){rings.splice(i,1)}
  }

  // Update rocks
  const lethalSpeed=1.8+diffT*0.02;
  for(let i=rocks.length-1;i>=0;i--){
    const rk=rocks[i];
    const sx=rk.wx-scroll;
    if(sx<-60){rocks.splice(i,1);continue}
    // Collision with surfer
    const dx=sx-surferX,dy=rk.y-surferY;
    const dist=Math.sqrt(dx*dx+dy*dy);
    if(dist<rk.r+10){
      if(effectiveSpeed>lethalSpeed){
        emitParticles(surferX,surferY,25,0,5,1);
        gameOver();return;
      }else{
        speed=Math.max(speed-0.4,baseSpeed*0.5);
        emitParticles(sx,rk.y,8,30,2,0.5);
        rocks.splice(i,1);
        continue;
      }
    }
  }

  // Score
  score+=Math.round(effectiveSpeed*mult*dt*10);

  // Particles
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.x+=p.vx;p.y+=p.vy;
    p.vy+=0.06;
    p.life-=dt;
    p.alpha=Math.max(0,p.life/p.maxLife);
    if(p.life<=0)particles.splice(i,1);
  }

  // Foam
  if(rng()<0.3)emitFoam(surferX+5,surferY+4,1);
  for(let i=foamParticles.length-1;i>=0;i--){
    const f=foamParticles[i];
    f.x+=f.vx;f.y+=f.vy;
    f.life-=dt;
    f.alpha*=0.98;
    if(f.life<=0)foamParticles.splice(i,1);
  }

  // Shake decay
  shakeMag*=shakeDecay;
  if(shakeMag<0.1)shakeMag=0;
  shakeX=(Math.random()-0.5)*shakeMag*2;
  shakeY=(Math.random()-0.5)*shakeMag*2;

  // Vignette/desat decay
  vignetteAlpha*=0.96;
  desatFlash*=0.94;
}

// --- Draw ---
function draw(){
  ctx.save();
  // Shake
  if(state==='playing'||state==='gameover'){
    ctx.translate(shakeX,shakeY);
  }

  // Sky gradient
  const skyGrad=ctx.createLinearGradient(0,0,0,VH);
  const h1=(200+hueShift*0.3)%360;
  const h2=(220+hueShift*0.2)%360;
  skyGrad.addColorStop(0,`hsl(${h1},40%,8%)`);
  skyGrad.addColorStop(0.5,`hsl(${h2},50%,12%)`);
  skyGrad.addColorStop(1,`hsl(${(h2+10)%360},45%,6%)`);
  ctx.fillStyle=skyGrad;
  ctx.fillRect(0,0,VW,VH);

  // Stars (decorative, static)
  ctx.fillStyle='rgba(255,255,255,0.3)';
  const starSeed=mulberry32(42);
  for(let i=0;i<40;i++){
    const sx=starSeed()*VW,sy=starSeed()*VH*0.45;
    const ss=0.5+starSeed()*1.5;
    const twinkle=0.3+0.7*Math.abs(Math.sin(gameTime*2+i));
    ctx.globalAlpha=twinkle*0.4;
    ctx.fillRect(sx,sy,ss,ss);
  }
  ctx.globalAlpha=1;

  // Moon
  const moonX=VW*0.78,moonY=VH*0.12,moonR=22;
  const moonGrad=ctx.createRadialGradient(moonX,moonY,moonR*0.2,moonX,moonY,moonR);
  moonGrad.addColorStop(0,'rgba(255,250,230,0.9)');
  moonGrad.addColorStop(0.7,'rgba(200,210,230,0.3)');
  moonGrad.addColorStop(1,'rgba(200,210,230,0)');
  ctx.fillStyle=moonGrad;
  ctx.beginPath();ctx.arc(moonX,moonY,moonR*2,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='rgba(255,250,230,0.85)';
  ctx.beginPath();ctx.arc(moonX,moonY,moonR,0,Math.PI*2);ctx.fill();

  // Water layers
  drawWaterLayers();

  // Rocks
  for(const rk of rocks){
    const sx=rk.wx-scroll;
    if(sx<-60||sx>VW+60)continue;
    ctx.fillStyle=`hsl(${rk.hue},30%,25%)`;
    ctx.beginPath();ctx.arc(sx,rk.y,rk.r,0,Math.PI*2);ctx.fill();
    ctx.fillStyle=`hsl(${rk.hue},25%,35%)`;
    ctx.beginPath();ctx.arc(sx-rk.r*0.2,rk.y-rk.r*0.3,rk.r*0.5,0,Math.PI*2);ctx.fill();
  }

  // Rings
  for(const r of rings){
    const sx=r.wx-scroll;
    if(sx<-60||sx>VW+80)continue;
    const ry=waveY(sx)-30;
    const scale=r.locked?r.popScale:1;
    const baseHue=(180+hueShift)%360;
    ctx.save();
    ctx.translate(sx,ry);
    ctx.scale(scale,scale);
    // Glow
    if(r.glow>0.01){
      const grd=ctx.createRadialGradient(0,0,r.radius*0.5,0,0,r.radius*2);
      grd.addColorStop(0,`hsla(${baseHue},80%,70%,${r.glow*0.5})`);
      grd.addColorStop(1,`hsla(${baseHue},80%,70%,0)`);
      ctx.fillStyle=grd;
      ctx.beginPath();ctx.arc(0,0,r.radius*2,0,Math.PI*2);ctx.fill();
    }
    ctx.globalAlpha=r.alpha;
    ctx.strokeStyle=r.missed?`hsla(0,70%,60%,${r.alpha})`:`hsla(${baseHue},70%,65%,${r.alpha})`;
    ctx.lineWidth=r.locked?4:2.5;
    ctx.beginPath();ctx.arc(0,0,r.radius,0,Math.PI*2);ctx.stroke();
    // Inner dot
    if(!r.locked&&!r.missed){
      ctx.fillStyle=`hsla(${baseHue},80%,75%,${r.alpha*0.6})`;
      ctx.beginPath();ctx.arc(0,0,4,0,Math.PI*2);ctx.fill();
    }
    ctx.restore();
  }

  // Foam particles
  for(const f of foamParticles){
    ctx.globalAlpha=f.alpha;
    ctx.fillStyle='rgba(200,230,255,0.6)';
    ctx.beginPath();ctx.arc(f.x,f.y,f.size,0,Math.PI*2);ctx.fill();
  }
  ctx.globalAlpha=1;

  // Surfer
  drawSurfer();

  // Particles
  for(const p of particles){
    ctx.globalAlpha=p.alpha;
    ctx.fillStyle=`hsl(${p.hue},70%,60%)`;
    ctx.beginPath();ctx.arc(p.x,p.y,p.size*p.alpha,0,Math.PI*2);ctx.fill();
  }
  ctx.globalAlpha=1;

  // Vignette
  if(vignetteAlpha>0.01){
    const vig=ctx.createRadialGradient(VW/2,VH/2,VW*0.2,VW/2,VH/2,VW*0.8);
    vig.addColorStop(0,'rgba(0,0,0,0)');
    vig.addColorStop(1,`rgba(180,30,30,${vignetteAlpha})`);
    ctx.fillStyle=vig;
    ctx.fillRect(0,0,VW,VH);
  }

  // Desaturation flash
  if(desatFlash>0.02){
    ctx.fillStyle=`rgba(0,0,0,${desatFlash*0.3})`;
    ctx.fillRect(0,0,VW,VH);
  }

  // HUD
  if(state==='playing'){
    drawHUD();
  }

  ctx.restore();

  // Overlays (drawn without shake)
  if(state==='start')drawStartScreen();
  if(state==='gameover')drawGameOverScreen();
}

function drawWaterLayers(){
  // Back wave
  ctx.fillStyle='rgba(15,50,100,0.4)';
  ctx.beginPath();
  ctx.moveTo(0,VH);
  for(let x=0;x<=VW;x+=4){
    const y=waveBaseY+20+waveAmp*0.6*Math.sin(waveK*0.8*(x+scroll*0.6)+2)+15*Math.sin(0.03*(x+scroll*0.4));
    ctx.lineTo(x,y);
  }
  ctx.lineTo(VW,VH);ctx.closePath();ctx.fill();

  // Main wave body
  const wGrad=ctx.createLinearGradient(0,waveBaseY-waveAmp,0,VH);
  const wh=(200+hueShift*0.2)%360;
  wGrad.addColorStop(0,`hsla(${wh},60%,25%,0.9)`);
  wGrad.addColorStop(0.4,`hsla(${(wh+10)%360},55%,18%,0.95)`);
  wGrad.addColorStop(1,`hsla(${(wh+20)%360},50%,8%,1)`);
  ctx.fillStyle=wGrad;
  ctx.beginPath();
  ctx.moveTo(0,VH);
  for(let x=0;x<=VW;x+=3){
    ctx.lineTo(x,waveY(x));
  }
  ctx.lineTo(VW,VH);ctx.closePath();ctx.fill();

  // Wave crest highlight
  ctx.strokeStyle=`hsla(${(wh+30)%360},50%,50%,0.25)`;
  ctx.lineWidth=2;
  ctx.beginPath();
  for(let x=0;x<=VW;x+=3){
    const y=waveY(x);
    if(x===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);
  }
  ctx.stroke();

  // Foam line on crest
  ctx.strokeStyle='rgba(200,230,255,0.15)';
  ctx.lineWidth=1;
  ctx.beginPath();
  for(let x=0;x<=VW;x+=3){
    const y=waveY(x)-2;
    if(x===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);
  }
  ctx.stroke();
}

function drawSurfer(){
  ctx.save();
  ctx.translate(surferX,surferY-12);
  ctx.rotate(surferAngle);

  // Board
  ctx.fillStyle='#e8d8b0';
  ctx.beginPath();
  ctx.ellipse(0,6,16,3,0,0,Math.PI*2);
  ctx.fill();
  ctx.strokeStyle='#c4a870';
  ctx.lineWidth=1;
  ctx.stroke();

  // Body
  ctx.fillStyle='#2a6090';
  ctx.beginPath();
  ctx.ellipse(0,-5,5,8,0,0,Math.PI*2);
  ctx.fill();

  // Head
  ctx.fillStyle='#f0c8a0';
  ctx.beginPath();
  ctx.arc(0,-16,5.5,0,Math.PI*2);
  ctx.fill();

  // Arms
  ctx.strokeStyle='#f0c8a0';
  ctx.lineWidth=2;
  ctx.beginPath();ctx.moveTo(-4,-8);ctx.lineTo(-12,-4);ctx.stroke();
  ctx.beginPath();ctx.moveTo(4,-8);ctx.lineTo(12,-4);ctx.stroke();

  // Speed trail
  if(speed>1.5){
    const ta=Math.min((speed-1.5)/2,0.5);
    ctx.strokeStyle=`rgba(150,220,255,${ta})`;
    ctx.lineWidth=1.5;
    ctx.beginPath();
    ctx.moveTo(-14,6);
    ctx.lineTo(-14-speed*8,6+2);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(-14,8);
    ctx.lineTo(-14-speed*6,10);
    ctx.stroke();
  }

  ctx.restore();
}

function drawHUD(){
  // Score
  ctx.fillStyle='rgba(255,255,255,0.9)';
  ctx.font='bold 28px "Segoe UI",system-ui,sans-serif';
  ctx.textAlign='left';
  ctx.fillText(score.toString(),16,38);

  // Multiplier
  if(mult>1){
    const mhue=(120+combo*15)%360;
    ctx.fillStyle=`hsl(${mhue},70%,65%)`;
    ctx.font='bold 20px "Segoe UI",system-ui,sans-serif';
    ctx.fillText(`x${mult}`,16,62);
  }

  // Combo
  if(combo>0){
    ctx.fillStyle='rgba(255,255,255,0.5)';
    ctx.font='14px "Segoe UI",system-ui,sans-serif';
    ctx.fillText(`${combo} chain`,16,80);
  }

  // Best
  ctx.fillStyle='rgba(255,255,255,0.35)';
  ctx.font='13px "Segoe UI",system-ui,sans-serif';
  ctx.textAlign='right';
  ctx.fillText(`Best: ${bestScore}`,VW-16,34);

  // Miss indicators
  if(missStreak>0){
    ctx.fillStyle='rgba(255,80,80,0.7)';
    ctx.font='bold 14px "Segoe UI",system-ui,sans-serif';
    ctx.textAlign='right';
    ctx.fillText(`Miss ${missStreak}/2`,VW-16,58);
  }

  // Speed bar
  const barW=80,barH=4,barX=VW-16-barW,barY=68;
  ctx.fillStyle='rgba(255,255,255,0.1)';
  ctx.fillRect(barX,barY,barW,barH);
  const sf=Math.min(speed/3.5,1);
  const bh=sf>0.7?0:(sf>0.5?60:200);
  ctx.fillStyle=`hsl(${bh},60%,55%)`;
  ctx.fillRect(barX,barY,barW*sf,barH);
}

function drawStartScreen(){
  // Dim overlay
  ctx.fillStyle='rgba(10,22,40,0.7)';
  ctx.fillRect(0,0,VW,VH);

  // Title
  ctx.fillStyle='#fff';
  ctx.font='bold 36px "Segoe UI",system-ui,sans-serif';
  ctx.textAlign='center';
  ctx.fillText('Tide Tap',VW/2,VH*0.3);

  ctx.fillStyle='rgba(100,200,255,0.8)';
  ctx.font='16px "Segoe UI",system-ui,sans-serif';
  ctx.fillText('Crest Chain',VW/2,VH*0.3+30);

  // Challenge line
  if(urlScore>0){
    ctx.fillStyle='rgba(255,200,100,0.85)';
    ctx.font='bold 15px "Segoe UI",system-ui,sans-serif';
    ctx.fillText(`Beat this: ${urlScore} (x${urlMult})`,VW/2,VH*0.3+65);
  }

  // Today's Tide
  ctx.fillStyle='rgba(255,255,255,0.35)';
  ctx.font='12px "Segoe UI",system-ui,sans-serif';
  ctx.fillText(`Today's Tide #${dailySeed%10000}`,VW/2,VH*0.3+90);

  // Instructions
  const instY=VH*0.52;
  ctx.fillStyle='rgba(255,255,255,0.6)';
  ctx.font='14px "Segoe UI",system-ui,sans-serif';
  ctx.fillText('Tap when the ring meets the surfer',VW/2,instY);
  ctx.fillText('Chain hits for combo multiplier',VW/2,instY+22);
  ctx.fillText('Miss 2 rings = wipeout!',VW/2,instY+44);
  ctx.fillText('Avoid rocks at high speed',VW/2,instY+66);

  // Best
  if(bestScore>0){
    ctx.fillStyle='rgba(255,255,255,0.5)';
    ctx.font='15px "Segoe UI",system-ui,sans-serif';
    ctx.fillText(`Best: ${bestScore}`,VW/2,VH*0.78);
  }

  // Prompt
  const pulse=0.6+0.4*Math.abs(Math.sin(Date.now()*0.003));
  ctx.fillStyle=`rgba(255,255,255,${pulse})`;
  ctx.font='bold 18px "Segoe UI",system-ui,sans-serif';
  ctx.fillText('Tap to Start',VW/2,VH*0.88);
}

function drawGameOverScreen(){
  ctx.fillStyle='rgba(10,22,40,0.75)';
  ctx.fillRect(0,0,VW,VH);

  ctx.fillStyle='rgba(255,100,100,0.9)';
  ctx.font='bold 30px "Segoe UI",system-ui,sans-serif';
  ctx.textAlign='center';
  ctx.fillText('Wipeout!',VW/2,VH*0.3);

  ctx.fillStyle='#fff';
  ctx.font='bold 42px "Segoe UI",system-ui,sans-serif';
  ctx.fillText(score.toString(),VW/2,VH*0.42);

  ctx.fillStyle='rgba(255,255,255,0.5)';
  ctx.font='16px "Segoe UI",system-ui,sans-serif';
  ctx.fillText(`Best chain: x${mult}`,VW/2,VH*0.48);

  if(score>=bestScore&&score>0){
    ctx.fillStyle='rgba(255,200,50,0.9)';
    ctx.font='bold 16px "Segoe UI",system-ui,sans-serif';
    ctx.fillText('New Best!',VW/2,VH*0.54);
  }else{
    ctx.fillStyle='rgba(255,255,255,0.4)';
    ctx.font='14px "Segoe UI",system-ui,sans-serif';
    ctx.fillText(`Best: ${bestScore}`,VW/2,VH*0.54);
  }

  const pulse=0.5+0.5*Math.abs(Math.sin(Date.now()*0.003));
  ctx.fillStyle=`rgba(255,255,255,${pulse})`;
  ctx.font='bold 17px "Segoe UI",system-ui,sans-serif';
  ctx.fillText('Tap to Retry',VW/2,VH*0.72);
}

// --- Main loop ---
function loop(ts){
  requestAnimationFrame(loop);
  if(!lastTime){lastTime=ts;return}
  let dtRaw=(ts-lastTime)/1000;
  lastTime=ts;
  if(dtRaw>0.033)dtRaw=0.033;

  if(state==='playing'){
    accumulator+=dtRaw;
    let steps=0;
    while(accumulator>=STEP&&steps<8){
      update();
      accumulator-=STEP;
      steps++;
      if(state!=='playing')break;
    }
  }else{
    // Gentle animation for menus
    gameTime+=dtRaw;
    hueShift+=dtRaw*10;
    scroll+=30*dtRaw;
  }

  draw();
}
requestAnimationFrame(loop);

})();
</script>
</body>
</html>
